---
# Job Templates for AAP Controller - Dynatrace Remediation
controller_templates:
  # ---------------------------------------------------------------------------
  # High CPU Remediation
  # ---------------------------------------------------------------------------
  - name: "Remediate High CPU"
    description: "Restart pods experiencing high CPU usage"
    organization: "{{ organization_name }}"
    project: "{{ project_name }}"
    playbook: "playbooks/remediation/remediate_high_cpu.yml"
    inventory: "OpenShift Cluster"
    credentials:
      - "OpenShift API Credential"
    ask_variables_on_launch: true
    ask_labels_on_launch: true
    extra_vars:
      problem_id: ""
      affected_entity: ""
      namespace: "{{ target_namespace }}"

  # ---------------------------------------------------------------------------
  # Memory Exhaustion Remediation
  # ---------------------------------------------------------------------------
  - name: "Remediate Memory Exhaustion"
    description: "Scale deployment or restart pods with high memory usage"
    organization: "{{ organization_name }}"
    project: "{{ project_name }}"
    playbook: "playbooks/remediation/remediate_memory.yml"
    inventory: "OpenShift Cluster"
    credentials:
      - "OpenShift API Credential"
    ask_variables_on_launch: true
    ask_labels_on_launch: true
    extra_vars:
      problem_id: ""
      affected_entity: ""
      namespace: "{{ target_namespace }}"
      scale_replicas: 3

  # ---------------------------------------------------------------------------
  # Pod Crash Remediation
  # ---------------------------------------------------------------------------
  - name: "Remediate Pod Crash"
    description: "Delete crashed pods and trigger deployment rollout"
    organization: "{{ organization_name }}"
    project: "{{ project_name }}"
    playbook: "playbooks/remediation/remediate_pod_crash.yml"
    inventory: "OpenShift Cluster"
    credentials:
      - "OpenShift API Credential"
    ask_variables_on_launch: true
    ask_labels_on_launch: true
    extra_vars:
      problem_id: ""
      affected_entity: ""
      namespace: "{{ target_namespace }}"
      close_problem: true
      close_problem_delay: 30
      dynatrace_environment_url: "{{ dynatrace_environment_url }}"
      dynatrace_api_token: "{{ dynatrace_api_token }}"

  # ---------------------------------------------------------------------------
  # Create Dynatrace Problem
  # ---------------------------------------------------------------------------
  - name: "Create Dynatrace Problem"
    description: "Inject a problem into Dynatrace to trigger the workflow"
    organization: "{{ organization_name }}"
    project: "{{ project_name }}"
    playbook: "playbooks/utilities/create_test_problem.yml"
    inventory: "Localhost"
    ask_variables_on_launch: false
    extra_vars:
      problem_type: "pod_crash"
      timeout_minutes: 5
      target_entity: "demo-app"
      namespace: "{{ target_namespace }}"
      dynatrace_environment_url: "{{ dynatrace_environment_url }}"
      dynatrace_api_token: "{{ dynatrace_api_token }}"

